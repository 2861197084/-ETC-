# ETC äº¤é€šå¤§æ•°æ®å¹³å° - åŠŸèƒ½æ¥å£å®ç°æ¸…å•

> ğŸ“… ç”Ÿæˆæ—¶é—´ï¼š2025å¹´1æœˆ
> 
> æœ¬æ–‡æ¡£è¯¦ç»†åˆ—å‡ºäº†å‰ç«¯å„é¡µé¢åŠŸèƒ½ä¸åç«¯ API æ¥å£çš„å¯¹åº”å…³ç³»åŠå®ç°çŠ¶æ€

---

***æ€»ä½“å®ç°æ¥å£æ•°é‡ä¸å¯ä¿¡ï¼Œå»ºè®®çš„å®ç°æ–¹å¼ï¼Œæ‰¾å‡†ä¸€ä¸ªå°åŠŸèƒ½å…ˆå®ç°ï¼Œä¸è¦å¤šåŠŸèƒ½åŒæ—¶å¼€å‘ã€‚***

***å½“å‰åŠŸèƒ½æœ€åŸºç¡€åŠŸèƒ½è¿˜æ²¡æœ‰å®ç°çš„æœ‰ï¼Œæœ€åŸºç¡€çš„æŸ¥è¯¢è¿˜æ²¡æœ‰å®ç°ï¼Œå› ä¸ºä¹‹å‰èµ°çš„æ˜¯flinkä¼ è¾“ï¼Œä½†æ˜¯åœ¨æ¶ˆè´¹ä¸Šå­˜åœ¨é—®é¢˜ï¼Œåº”è¯¥æ˜¯ä»£ç ä¸Šå­˜åœ¨é—®é¢˜ï¼Œ***è¦ä¸å°±å…ˆå®ç°ä¸ªå…¨ä¸èµ°flinkå§ï¼Œå°±æœ€æ™®é€šçš„å®ç°ï¼Œåé¢å†æ”¹ï¼Œæ€ä¹ˆæ’å…¥flinkã€‚

***å…¨å±€é¡µé¢åˆ·æ–°æš‚å®šä¸€åˆ†é’Ÿï¼Œé”™å³°åˆ·æ–°ã€‚***



## ğŸ“Š æ€»ä½“å®ç°çŠ¶æ€

| æ¨¡å— | é¡µé¢æ•° | æ¥å£æ€»æ•° | å·²å®ç° | éƒ¨åˆ†å®ç° | æœªå®ç° |
|------|--------|---------|--------|----------|--------|
| åœ°å›¾å¤§å± (Monitor) | 1 | 5 | 4 | 1 | 0 |
| å®æ—¶ç›‘æ§ (Realtime) | 1 | 5 | 5 | 0 | 0 |
| æ•°æ®æŸ¥è¯¢ (Query) | 1 | 7 | 5 | 2 | 0 |
| ç¦»çº¿é¢„æµ‹ (Prediction) | 1 | 3 | 0 | 0 | 3 |
| è½¦ä¸»ç«¯ (Owner) | 2 | 10 | 3 | 2 | 5 |
| è®¤è¯ç³»ç»Ÿ (Auth) | - | 4 | 4 | 0 | 0 |
| **åˆè®¡** | **6** | **34** | **21** | **5** | **8** |

---

## ğŸ—ºï¸ æ¨¡å—ä¸€ï¼šåœ°å›¾å¤§å± (Monitor)

**é¡µé¢è·¯å¾„**: `/etc/monitor`  
**Vue ç»„ä»¶**: [frontend/src/views/etc/monitor/index.vue](../frontend/src/views/etc/monitor/index.vue)

### åŠŸèƒ½æ¸…å•

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 1.1 | ä»Šæ—¥ç»Ÿè®¡æ•°æ® | `getDailyStats()` | `GET /admin/realtime/daily-stats` | âœ… å·²å®ç° | è¿”å› totalFlow, totalRevenue, avgSpeed, alertCount, checkpointCount, onlineCountã€‚***å®ç°äº†ä¸ªå±ï¼Œè¿™é‡Œç”¨sqlç»Ÿè®¡åˆ·æ–°ï¼Œ*** |
| 1.2 | å¡å£åˆ—è¡¨(åœ°å›¾) | `getCheckpoints()` | `GET /admin/map/checkpoints` | âœ… å·²å®ç° | è¿”å›19ä¸ªå‡ºå¸‚å¡å£åæ ‡ã€çŠ¶æ€ã€æµé‡ã€‚***æµé‡æˆ‘æ²¡éªŒè¯æ˜¯å¦æ˜¯å‡æ•°æ®äº†ï¼Œè¿™é‡Œéœ€è¦æ ¸å®ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å†™sqlåˆ·æ–°å§ï¼Œç•¥å¾®åŠ ä¸ªåˆ¤æ–­æ˜¯å¦ä¸ºç¹å¿™*** |
| 1.3 | åŒºåŸŸæ’åç»Ÿè®¡ | ç”± `getCheckpoints()` è®¡ç®— | å‰ç«¯èšåˆ | âœ… å·²å®ç° | æŒ‰åŒºåŸŸåˆ†ç»„ç»Ÿè®¡ currentFlowï¼Œ***èµ°sqlï¼Œåˆ·æ–°*** |
| 1.4 | æœ¬åœ°/å¤–åœ°è½¦è¾†ç»Ÿè®¡ | å‰ç«¯ä¼°ç®— (70%/30%) | - | âš ï¸ éƒ¨åˆ†å®ç° | åç«¯æœªæä¾›çœŸå®å¸ƒéš†è¿‡æ»¤å™¨ç»Ÿè®¡ã€‚***è¿™ä¸ªå…ˆä¸å®ç°*** |
| 1.5 | å‘Šè­¦åˆ—è¡¨ | `getViolations()` + `getClonePlates()` | `GET /admin/realtime/violations` + `GET /admin/realtime/clone-plates` | âœ… å·²å®ç° | ç»„åˆä¸¤ä¸ªæ¥å£è·å–å‘Šè­¦ã€‚***è¿™ä¸ªæš‚æ—¶å®ç°å¥½äº†ï¼Œä½†ä¸å¥½çœ‹ï¼Œæˆ‘åé¢æ¥æ”¹ä¸‹æ ·å¼*** |

### ç»„ä»¶ä¾èµ–

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| `XuzhouTrafficMap` | [components/business/etc/XuzhouTrafficMap.vue](../frontend/src/components/business/etc/XuzhouTrafficMap.vue) | å¾å·åœ°å›¾ç»„ä»¶ |
| `BloomStats` | [components/business/etc/BloomStats.vue](../frontend/src/components/business/etc/BloomStats.vue) | æœ¬åœ°/å¤–åœ°è½¦è¾†ç»Ÿè®¡ |
| `RegionRank` | [components/business/etc/RegionRank.vue](../frontend/src/components/business/etc/RegionRank.vue) | åŒºåŸŸæµé‡æ’å |
| `AlertTicker` | [components/business/etc/AlertTicker.vue](../frontend/src/components/business/etc/AlertTicker.vue) | å‘Šè­¦æ»šåŠ¨æ¡ |

### å¾…å®Œå–„é¡¹

***ä¸ç†ä»– ä¸ç†è¿™ä¸ª***

1. **æœ¬åœ°/å¤–åœ°è½¦è¾†ç»Ÿè®¡** - ç›®å‰å‰ç«¯å›ºå®š70%/30%ä¼°ç®—
   - [ ] åç«¯å®ç°ï¼šåœ¨ `RealtimeService` æ·»åŠ  `getVehicleSourceStats()` æ–¹æ³•
   - [ ] æ¥å£ï¼š`GET /admin/realtime/vehicle-source` (å·²å®šä¹‰ï¼Œéœ€è¿æ¥çœŸå®æ•°æ®)
   - [ ] æ•°æ®æ¥æºï¼šä» Redis è¯»å– Flink å®æ—¶è®¡ç®—çš„å¸ƒéš†è¿‡æ»¤å™¨ç»“æœ

---

## ğŸ“¡ æ¨¡å—äºŒï¼šå®æ—¶ç›‘æ§ (Realtime)

**é¡µé¢è·¯å¾„**: `/etc/realtime`  
**Vue ç»„ä»¶**: [frontend/src/views/etc/realtime/index.vue](../frontend/src/views/etc/realtime/index.vue)

### åŠŸèƒ½æ¸…å•

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 2.1 | ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡ | `getDailyStats()` | `GET /admin/realtime/daily-stats` | âœ… å·²å®ç° | todayTotal, todayRevenue, avgSpeed, alertCountã€‚***sql\åˆ·æ–°*** |
| 2.2 | å¥—ç‰Œè½¦æ£€æµ‹åˆ—è¡¨ | `getClonePlates({ pageSize: 5 })` | `GET /admin/realtime/clone-plates` | âœ… å·²å®ç° | è¿”å› plateNumber, checkpoint1, checkpoint2, time1, time2ã€‚***è¿™ä¸ªflinkå·²ç»å†™å¥½äº†ï¼Œå¯ä»¥èµ°å®æ—¶ä¹Ÿå¯ä»¥èµ°sqlåˆ·æ–°*** |
| 2.3 | è¿è§„ä¿¡æ¯åˆ—è¡¨ | `getViolations({ type, pageSize })` | `GET /admin/realtime/violations` | âœ… å·²å®ç° | æ”¯æŒ type ç­›é€‰ (overspeed/overload/illegal)ã€‚***sql\åˆ·æ–°*** |
| 2.4 | ç«™å£å‹åŠ›é¢„è­¦ | `getPressureWarnings()` | `GET /admin/realtime/pressure-warnings` | âœ… å·²å®ç° | è¿”å›19ä¸ªå¡å£çš„å‹åŠ›ç­‰çº§ã€æµé‡ã€å»ºè®®***sql\åˆ·æ–°*** |
| 2.5 | è¿è§„ç±»å‹ç­›é€‰ | `watch(violationType, loadViolations)` | å‰ç«¯è”åŠ¨ | âœ… å·²å®ç° | åˆ‡æ¢ Tab è‡ªåŠ¨åˆ·æ–°ã€‚sql |

### åç«¯æœåŠ¡å®ç°

**æ§åˆ¶å™¨**: [AdminRealtimeController.java](../backend/src/main/java/com/etc/platform/controller/AdminRealtimeController.java)  
**æœåŠ¡ç±»**: [RealtimeService.java](../backend/src/main/java/com/etc/platform/service/RealtimeService.java)

```java
// å…³é”®æ–¹æ³•
getDailyStats()           // ä» Redis/MySQL è·å–ä»Šæ—¥ç»Ÿè®¡
getClonePlateDetections() // ä» clone_plate_detection è¡¨æŸ¥è¯¢
getViolationsWithFilter() // ä» violation è¡¨æŸ¥è¯¢ï¼Œæ”¯æŒç±»å‹ç­›é€‰
getAllPressureWarnings()  // ä» Redis è·å–å‹åŠ›é¢„è­¦ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®
```

### æ•°æ®æµ

***ä¸èµ°flinkå“ˆ***

```
Kafka (etc-pass-records)
    â†“
Flink Job (å®æ—¶è®¡ç®—)
    â†“
Redis (realtime:* å‰ç¼€)
    â†“
RealtimeService (ä¼˜å…ˆè¯» Redisï¼Œå›é€€ MySQL)
    â†“
å‰ç«¯å±•ç¤º
```

---

## ğŸ” æ¨¡å—ä¸‰ï¼šæ•°æ®æŸ¥è¯¢ (Query)

**é¡µé¢è·¯å¾„**: `/etc/query`  
**Vue ç»„ä»¶**: [frontend/src/views/etc/query/index.vue](../frontend/src/views/etc/query/index.vue)

### åŠŸèƒ½æ¸…å•

#### Tab 1: å¿«æ·æŸ¥è¯¢

***ä»¥ä¸‹åªå®ç°åŒè¡Œè®°å½•æ€»æ•°çš„æŸ¥è¯¢ï¼Œæœ‰æ•°å°±å¥½äº†ï¼Œå…¶ä»–çš„å…ˆåˆ«åšï¼Œæ¸è¿›å¼çš„é€»è¾‘æˆ‘æ¥å†™***

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 3.1 | é€šè¡Œè®°å½•æŸ¥è¯¢ | `searchRecords(params)` | `GET /admin/query/records` | âœ… å·²å®ç° | æ”¯æŒ plateNumber, checkpointId, startTime, endTime, vehicleType ç­›é€‰ |
| 3.2 | åˆ†é¡µåŠ è½½ | `currentPage`, `pageSize` | `page`, `pageSize` å‚æ•° | âœ… å·²å®ç° | åç«¯ JPA åˆ†é¡µ |
| 3.3 | æŸ¥è¯¢ç±»å‹åˆ‡æ¢ | `queryType` (traffic/revenue/violation/speed/clone) | `queryType` å‚æ•° | âš ï¸ éƒ¨åˆ†å®ç° | å‰ç«¯åˆ‡æ¢åˆ—ï¼Œåç«¯æš‚æ— å·®å¼‚åŒ–é€»è¾‘ |
| 3.4 | å¯¼å‡ºç»“æœ | `exportQueryResult()` | `POST /admin/query/export` | âš ï¸ éƒ¨åˆ†å®ç° | è¿”å›æ¨¡æ‹Ÿä¸‹è½½é“¾æ¥ |
| 3.5 | åŠ è½½æ›´å¤šå†å²æ•°æ® | `queryRecords({ source: 'hbase' })` | `GET /api/progressive/records` | âœ… å·²å®ç° | æŸ¥è¯¢ç»“æœåº•éƒ¨æŒ‰é’®ï¼Œä» HBase åŠ è½½è¶…è¿‡7å¤©çš„å†å²æ•°æ® |

#### Tab 2: æ™ºèƒ½æŸ¥è¯¢ (Text2SQL)

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 3.6 | Text2SQL | `text2sql({ query })` | `POST /admin/query/text2sql` | âœ… å·²å®ç° | ç®€å•å…³é”®è¯åŒ¹é…å®ç° |
| 3.7 | æ‰§è¡Œ SQL | `executeQuery({ sql })` | `POST /admin/query/execute` | âœ… å·²å®ç° | ä»…æ”¯æŒ SELECT |

### æ¸è¿›å¼åŠ è½½ç­–ç•¥

æŸ¥è¯¢ç»“æœåº•éƒ¨æä¾›ã€ŒåŠ è½½æ›´å¤šå†å²æ•°æ® (HBase)ã€æŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡»åä» HBase åŠ è½½è¶…è¿‡7å¤©çš„å†å²æ•°æ®ï¼Œè¿½åŠ åˆ°å½“å‰ç»“æœä¸‹æ–¹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL æŸ¥è¯¢ç»“æœ (7å¤©å†…çƒ­æ•°æ®)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åŠ è½½æ›´å¤šå†å²æ•°æ® (HBase)]                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HBase å†å²æ•°æ® (æŒ‰éœ€åŠ è½½)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åç«¯æœåŠ¡å®ç°

**æ§åˆ¶å™¨**: [AdminQueryController.java](../backend/src/main/java/com/etc/platform/controller/AdminQueryController.java)  
**æœåŠ¡ç±»**: [PassRecordService.java](../backend/src/main/java/com/etc/platform/service/PassRecordService.java)

### å¾…å®Œå–„é¡¹

1. **æŸ¥è¯¢ç±»å‹å·®å¼‚åŒ–** - ç›®å‰æ‰€æœ‰ç±»å‹è¿”å›ç›¸åŒæ•°æ®
   - [ ] `queryType=speed` åº”åªè¿”å›è¶…é€Ÿè®°å½• (speed > minSpeed)
   - [ ] `queryType=violation` åº”è”æŸ¥ violation è¡¨
   - [ ] `queryType=revenue` åº”è¿”å› etcDeduction ç»Ÿè®¡

2. **å¯¼å‡ºåŠŸèƒ½**
   - [ ] å®ç°çœŸå® Excel å¯¼å‡º (Apache POI)
   - [ ] å®ç° CSV å¯¼å‡º

---

## ğŸ“ˆ æ¨¡å—å››ï¼šç¦»çº¿é¢„æµ‹ (Prediction)

**é¡µé¢è·¯å¾„**: `/etc/prediction`  
**Vue ç»„ä»¶**: [frontend/src/views/etc/prediction/index.vue](../frontend/src/views/etc/prediction/index.vue)

### åŠŸèƒ½æ¸…å•

***ç¦»çº¿é¢„æµ‹å†™ä¸€ä¸‹***

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 4.1 | æ¨¡å‹å‡†ç¡®ç‡å›¾è¡¨ | æœ¬åœ° ECharts | - | âŒ æœªå®ç° | å‰ç«¯ Mock 94.5% |
| 4.2 | æµé‡è¶‹åŠ¿å¯¹æ¯” | æœ¬åœ° ECharts | - | âŒ æœªå®ç° | å‰ç«¯ Mock æ•°æ® |
| 4.3 | æ‹¥å µçƒ­åŠ›å›¾ | æœ¬åœ° ECharts | - | âŒ æœªå®ç° | å‰ç«¯ Mock æ•°æ® |
| 4.4 | è·¯æ®µé¢„æµ‹è¡¨æ ¼ | æœ¬åœ° `roadPredictions` | - | âŒ æœªå®ç° | å‰ç«¯ Mock æ•°æ® |

### åç«¯ç°æœ‰æ¥å£

**æ§åˆ¶å™¨**: [AdminPredictController.java](../backend/src/main/java/com/etc/platform/controller/AdminPredictController.java)

```java
GET /admin/predict/checkpoint/{id}  // è·å–å•å¡å£é¢„æµ‹ï¼ˆç®€å•æ¨¡æ‹Ÿï¼‰
GET /admin/predict/checkpoints      // è·å–æ‰€æœ‰å¡å£é¢„æµ‹æ±‡æ€»
GET /admin/predict/history/{id}     // è·å–å†å²æ•°æ®ï¼ˆå¼€å‘ä¸­ï¼‰
```

### å¾…å®ç°

1. **æ¥å…¥æœºå™¨å­¦ä¹ æ¨¡å‹**
   - [ ] é›†æˆ Spark MLlib æˆ– Python æœåŠ¡
   - [ ] å®ç° LSTM æµé‡é¢„æµ‹æ¨¡å‹
   - [ ] å®šæ—¶æ‰¹é‡é¢„æµ‹ï¼ˆæ¯å°æ—¶ä¸€æ¬¡ï¼‰

2. **å‰ç«¯å¯¹æ¥**
   - [ ] åˆ›å»º `/api/admin/predict.ts` API æ–‡ä»¶
   - [ ] æ›¿æ¢ Mock æ•°æ®ä¸ºçœŸå®æ¥å£è°ƒç”¨

---







***è½¦ä¸»ç«¯éƒ½å…ˆè¿˜ä¸å†™***







## ğŸš— æ¨¡å—äº”ï¼šè½¦ä¸»ç«¯ (Owner)

### 5.1 åœ°å›¾æœåŠ¡é¡µé¢

**é¡µé¢è·¯å¾„**: `/owner/map`  
**Vue ç»„ä»¶**: [frontend/src/views/owner/map/index.vue](../frontend/src/views/owner/map/index.vue)

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 5.1.1 | å¡å£åˆ—è¡¨ | éœ€å®ç° | `GET /owner/map/checkpoints` | âŒ æœªå®ç° | åç«¯æ— å¯¹åº”æ¥å£ |
| 5.1.2 | çƒ­åŠ›å›¾ | éœ€å®ç° | `GET /owner/map/heatmap` | âŒ æœªå®ç° | åç«¯æ— å¯¹åº”æ¥å£ |

### 5.2 æˆ‘çš„è®°å½•é¡µé¢

**é¡µé¢è·¯å¾„**: `/owner/records`  
**Vue ç»„ä»¶**: [frontend/src/views/owner/records/index.vue](../frontend/src/views/owner/records/index.vue)

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 5.2.1 | é€šè¡Œè®°å½•åˆ—è¡¨ | `getPassRecords()` | `GET /owner/records/pass` | âœ… å·²å®ç° | å¤ç”¨ PassRecordService |
| 5.2.2 | è®°å½•è¯¦æƒ… | `getPassRecordDetail()` | `GET /owner/records/pass/{id}` | âœ… å·²å®ç° | - |
| 5.2.3 | æœç´¢è®°å½• | `searchPassRecords()` | `GET /owner/records/search` | âœ… å·²å®ç° | æŒ‰å…³é”®è¯æœç´¢ |
| 5.2.4 | å¼‚å¸¸æé†’ | å‰ç«¯ Mock | - | âŒ æœªå®ç° | åç«¯éœ€å®ç°ç”¨æˆ·å…³è”å‘Šè­¦ |
| 5.2.5 | è´¦å•æ±‡æ€» | API å·²å®šä¹‰ | `GET /owner/bills/summary` | âš ï¸ éƒ¨åˆ†å®ç° | è¿”å› Mock æ•°æ® |
| 5.2.6 | è´¦å•æ˜ç»† | API å·²å®šä¹‰ | `GET /owner/bills/details` | âš ï¸ éƒ¨åˆ†å®ç° | è¿”å› Mock æ•°æ® |
| 5.2.7 | æ™ºèƒ½æŸ¥è¯¢ | `ownerText2sql()` | `POST /owner/records/text2sql` | âœ… å·²å®ç° | å¤ç”¨ PassRecordService |
| 5.2.8 | ç”³è¯·å‘ç¥¨ | API å·²å®šä¹‰ | `POST /owner/bills/invoice` | âŒ æœªå®ç° | ä»…è¿”å›æ¨¡æ‹Ÿç»“æœ |
| 5.2.9 | å¯¼å‡ºè´¦å• | API å·²å®šä¹‰ | `GET /owner/bills/export` | âŒ æœªå®ç° | ä»…è¿”å›æ¨¡æ‹Ÿé“¾æ¥ |

### åç«¯æ§åˆ¶å™¨

**æ–‡ä»¶**: [OwnerController.java](../backend/src/main/java/com/etc/platform/controller/OwnerController.java)

---

## ğŸ” æ¨¡å—å…­ï¼šè®¤è¯ç³»ç»Ÿ (Auth)

**API æ–‡ä»¶**: [frontend/src/api/auth.ts](../frontend/src/api/auth.ts)

| åºå· | åŠŸèƒ½åç§° | å‰ç«¯è°ƒç”¨ | åç«¯æ¥å£ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|---------|----------|------|------|
| 6.1 | ç™»å½• | `fetchLogin()` | `POST /api/auth/login` | âœ… å·²å®ç° | è¿”å› token, refreshToken |
| 6.2 | ç™»å‡º | - | `POST /api/auth/logout` | âœ… å·²å®ç° | æ¸…é™¤ token |
| 6.3 | åˆ·æ–° Token | - | `POST /api/auth/refresh` | âœ… å·²å®ç° | - |
| 6.4 | ç”¨æˆ·ä¿¡æ¯ | `fetchGetUserInfo()` | `GET /api/user/info` | âœ… å·²å®ç° | è¿”å›ç”¨æˆ·åã€è§’è‰²ã€æƒé™ |

---

## ğŸ”§ å®ç°ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ (æ ¸å¿ƒåŠŸèƒ½)

1. **[3.3] æŸ¥è¯¢ç±»å‹å·®å¼‚åŒ–**
   - æ–‡ä»¶: `PassRecordService.java`
   - ä»»åŠ¡: æ ¹æ® queryType è¿”å›ä¸åŒç»“æœ
   
2. **[1.4] æœ¬åœ°/å¤–åœ°è½¦è¾†ç»Ÿè®¡**
   - æ–‡ä»¶: `RealtimeService.java`
   - ä»»åŠ¡: è¿æ¥ Redis å¸ƒéš†è¿‡æ»¤å™¨æ•°æ®

3. **[3.8] å¯¼å‡ºåŠŸèƒ½**
   - æ–‡ä»¶: `AdminQueryController.java`
   - ä»»åŠ¡: æ·»åŠ  Apache POI ä¾èµ–ï¼Œå®ç° Excel å¯¼å‡º

### ä¸­ä¼˜å…ˆçº§ (åŠŸèƒ½å¢å¼º)

4. **[4.x] é¢„æµ‹é¡µé¢æ¥å£**
   - æ–‡ä»¶: æ–°å»º `frontend/src/api/admin/predict.ts`
   - ä»»åŠ¡: å¯¹æ¥ç°æœ‰ AdminPredictController

5. **[5.2.5/5.2.6] è½¦ä¸»è´¦å•**
   - æ–‡ä»¶: `OwnerController.java`
   - ä»»åŠ¡: ä» pass_record è¡¨èšåˆçœŸå®è´¦å•æ•°æ®

6. **[5.2.4] è½¦ä¸»å¼‚å¸¸æé†’**
   - æ–‡ä»¶: æ–°å»º `OwnerAlertService.java`
   - ä»»åŠ¡: å…³è”ç”¨æˆ·è½¦è¾†ä¸å‘Šè­¦æ•°æ®

### ä½ä¼˜å…ˆçº§ (å¯é€‰å¢å¼º)

7. **[5.1.x] è½¦ä¸»åœ°å›¾æœåŠ¡**
8. **[5.2.8/5.2.9] å‘ç¥¨ä¸å¯¼å‡º**

---

## ğŸ“ é™„å½•ï¼šæ•°æ®åº“è¡¨ä¸æ¥å£æ˜ å°„

| è¡¨å | å¯¹åº”æ¥å£ | è¯´æ˜ |
|------|---------|------|
| `pass_record` | `/admin/query/records`, `/api/progressive/*` | é€šè¡Œè®°å½•(åˆ†ç‰‡) |
| `checkpoint` | `/admin/map/checkpoints` | 19ä¸ªå‡ºå¸‚å¡å£ |
| `violation` | `/admin/realtime/violations` | è¿è§„è®°å½• |
| `clone_plate_detection` | `/admin/realtime/clone-plates` | å¥—ç‰Œæ£€æµ‹ |
| `checkpoint_flow` | `/admin/realtime/flow` | å¡å£æµé‡ç»Ÿè®¡ |
| `alert` | `/admin/realtime/pressure-warnings` | å‘Šè­¦è®°å½• |
| `sys_user` | `/api/auth/*`, `/api/user/*` | ç”¨æˆ·è¡¨ |

---

## ğŸ› ï¸ å¿«é€Ÿå®šä½

### å‰ç«¯ API æ–‡ä»¶

```
frontend/src/api/
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ map.ts          # åœ°å›¾ç›¸å…³
â”‚   â”œâ”€â”€ query.ts        # æ•°æ®æŸ¥è¯¢
â”‚   â”œâ”€â”€ realtime.ts     # å®æ—¶æ•°æ®
â”‚   â””â”€â”€ progressive.ts  # æ¸è¿›å¼åŠ è½½
â”œâ”€â”€ owner/
â”‚   â”œâ”€â”€ records.ts      # é€šè¡Œè®°å½•
â”‚   â”œâ”€â”€ bills.ts        # è´¦å•
â”‚   â””â”€â”€ alerts.ts       # å‘Šè­¦
â””â”€â”€ auth.ts             # è®¤è¯
```

### åç«¯ Controller æ–‡ä»¶

```
backend/src/main/java/com/etc/platform/controller/
â”œâ”€â”€ AdminMapController.java       # /admin/map/*
â”œâ”€â”€ AdminQueryController.java     # /admin/query/*
â”œâ”€â”€ AdminRealtimeController.java  # /admin/realtime/*
â”œâ”€â”€ AdminPredictController.java   # /admin/predict/*
â”œâ”€â”€ ProgressiveLoadController.java # /api/progressive/*
â”œâ”€â”€ OwnerController.java          # /owner/*
â””â”€â”€ AuthController.java           # /api/auth/*, /api/user/*
```

---

*æ–‡æ¡£ç»“æŸ - è¯·æ ¹æ®ä¼˜å…ˆçº§é€æ­¥å®ç°å¾…å®Œå–„åŠŸèƒ½*
