# ETC高速公路大数据管理平台：需求分析与项目规划设计方案

> 面向课程题目“高速公路ETC大数据管理平台”进行扩展性设计。目标是在满足“数据扩充（50条/秒）、预处理、HBase或MyCat+MySQL（ShardingSphere）存储、交互式查询、30秒刷新可视化大屏、典型业务场景”要求的同时，补齐一个可落地的工程化项目方案。

---

## 1. 背景与问题定义

### 1.1 业务背景

高速公路ETC系统持续产生过车/计费/卡口数据，具备典型的“高吞吐、强时序、强查询、强实时展示”特征。交通管理部门需要对全网运行态势、异常车辆（如套牌车）、收费站/路段拥堵进行实时监控与研判；普通车主需要更精准的线路规划、拥堵预测、费用估算与行程提醒。

### 1.2 现状痛点

* 数据来源多、格式不统一，存在缺失、重复、时钟漂移、车辆信息不一致等问题。
* 既要实时告警（秒级）又要历史分析（分钟到小时级），对架构要求高。
* 需要支持“按车牌/卡口/时间窗口”的高频点查，以及“按路段/站点/时间段”的聚合统计。
* 可视化大屏需要稳定刷新（每30秒）且数据可信。

### 1.3 项目目标

* 建成一个可扩展、可观测、可演示的ETC大数据管理平台。
* 实时接入并模拟扩充数据（50条/秒），完成预处理。
* 支持两类用户：交通管理人员、普通车主。
* 采用 HBase 与 MySQL 分片（MyCat 或 ShardingSphere）构建冷热分层存储与查询。
* 交互式查询与动态大屏（30秒刷新）。
* 实现典型业务场景：实时套牌车检测、车流预警预测，并可在大屏/执法端呈现。

---

## 2. 用户与角色（两类人群）

### 2.1 交通管理人员（监管/指挥/稽核）

* 关注：全网运行态势、拥堵与事件、异常车辆、稽核逃费、收费站压力、应急调度。
* 核心动作：查看大屏、筛选查询、查看告警详情、下发处置、导出报表。

### 2.2 普通车主（出行/运营车辆车主）

* 关注：路线规划、预计到达时间、拥堵预测、费用估算、通行记录、异常提醒（疑似套牌/违章风险提示）。
* 核心动作：规划路线、查看实时路况、订阅路线提醒、查询通行账单、车辆行驶轨迹回放（授权范围内）。

---

## 3. 需求范围与边界

### 3.1 范围内

* 数据：ETC过车/卡口/收费站车流等（支持扩展到气象、事件、施工信息）。
* 平台：数据接入、预处理、存储、实时计算、告警、查询服务、可视化大屏、车主端能力。
* 业务：套牌检测、车流预警、拥堵预测与建议、路线规划（MVP级）。

### 3.2 范围外（可选增强）

* 与真实收费结算系统对接、支付与账务对账闭环。
* 精细化收费策略模拟与定价。

---

## 4. 数据与指标体系设计

### 4.1 数据域划分

1. **过车事件（Gantry/卡口）**：车辆在门架/卡口被识别的一条记录。
2. **收费站通行/交易（Toll Transaction）**：进出站、费用、车型等。
3. **设备/站点元数据（Dimension）**：站点、门架、路段、地理信息。
4. **告警事件（Alert）**：套牌疑似、拥堵预警、设备异常。

### 4.2 建议字段（可与实际数据样例映射）

> 由于数据样例可能随课程包变化，平台采用“可配置映射”的方式接入；以下为推荐统一模型。

#### 4.2.1 题目提供数据字段说明（交通流量样例）

课程样例数据中给出了如下字段（字段名为英文缩写，含义见右侧中文注释）。其中车牌字段已做脱敏处理：仅保留前4位，其余用 `***` 替代。

| 字段名               | 中文含义   | 推荐类型               | 示例/说明               | 对应统一模型字段                                    |                                      |                   |
| ----------------- | ------ | ------------------ | ------------------- | ------------------------------------------- | ------------------------------------ | ----------------- |
| `GCXH`            | 序号     | BIGINT             | 明细记录序号（不建议作为全局主键）   | `event_id`（建议改为UUID/雪花ID）                   |                                      |                   |
| `XZQHMC`          | 行政区划   | VARCHAR            | 省/市/区名称或代码（以数据为准）   | `region_code` / `region_name`（维表扩展）         |                                      |                   |
| `KKMC`            | 卡口名称   | VARCHAR            | 门架/卡口名称             | `gantry_id`/`camera_id` + `gantry_name`（维表） |                                      |                   |
| `FXLX`            | 方向     | TINYINT/VARCHAR    | 上行/下行/进城/出城等（以字典为准） | `direction`                                 |                                      |                   |
| `GCSJ`            | 过车时间   | DATETIME/TIMESTAMP | 车辆经过卡口的时间           | `event_time`                                |                                      |                   |
| `HPZL`            | 号牌种类   | TINYINT/VARCHAR    | 蓝牌/黄牌/新能源等（以字典表映射）  | `plate_color`/`plate_type`（统一口径）            |                                      |                   |
| `SUBSTR(HPHM,1,4) |        | '***'`             | 车牌（脱敏）              | VARCHAR                                     | 仅用于展示与联动；如需检测套牌，建议在受控环境保留原始值或使用不可逆哈希 | `plate_no`（展示层脱敏） |
| `CLPPXH`          | 车辆品牌型号 | VARCHAR            | 品牌+型号或编码            | `brand`/`model`（可选维度）                       |                                      |                   |

> 接入策略建议：
>
> * 统一将 `KKMC` 映射为站点/门架维表中的 `gantry_name`，并补齐唯一ID（`gantry_id`）。
> * `GCXH` 仅作为源数据序号保留在 `source_seq` 字段中，平台内部事件主键使用可分布式生成的 `event_id`。
> * 车牌脱敏在“展示层”实现更灵活：存储层保留原始字段（或哈希化），展示层按权限做遮罩。

**过车事件**

* event_id（全局唯一）
* event_time（毫秒时间戳）
* plate_no（车牌）
* plate_color（蓝/黄/绿/白/黑等）
* vehicle_type（客/货/危化/大巴等）
* gantry_id / camera_id
* station_id（就近收费站，可为空）
* road_id / section_id
* direction（上行/下行）
* lane_no
* speed_kmh（可为空）
* axles / weight（可为空）
* province_code（车牌归属）
* img_url（可为空）
* source（ETC/卡口/融合）

**过车事件**

* event_id（全局唯一）
* event_time（毫秒时间戳）
* plate_no（车牌）
* plate_color（蓝/黄/绿/白/黑等）
* vehicle_type（客/货/危化/大巴等）
* gantry_id / camera_id
* station_id（就近收费站，可为空）
* road_id / section_id
* direction（上行/下行）
* lane_no
* speed_kmh（可为空）
* axles / weight（可为空）
* province_code（车牌归属）
* img_url（可为空）
* source（ETC/卡口/融合）

**收费交易**

* txn_id
* entry_station_id / exit_station_id
* entry_time / exit_time
* fee
* discount
* pay_type（ETC/现金/混合）

### 4.3 核心指标（大屏与报表）

* 实时过车量：全网/分路段/分站点（1min、5min滚动）
* 平均速度、拥堵指数（可由速度或车流密度估算）
* 告警数量：套牌疑似、超速高风险、逆行（可选）、设备离线
* TOP榜：车流最高收费站、拥堵路段、告警热点卡口
* 预测指标：未来15/30/60分钟站点车流与拥堵风险等级

---

## 5. 功能需求（按模块）

### 5.1 数据接入与扩充

* **实时数据生成/扩充（50条/秒）**

  * 从课程数据样例中抽取分布（车牌、站点、时间间隔、速度、方向等），生成合成事件。
  * 扩充策略：

    * 基于规则的时空一致性生成（同一车牌在合理车速下穿越相邻门架）。
    * 基于AI的“属性补全与扰动”：车型、颜色、轴数、重量、支付方式等。
  * 输出到Kafka Topic（如 `etc_pass_event`、`etc_toll_txn`）。

* **数据质量控制**

  * 重复数据去重（event_id、plate+gantry+time窗口）。
  * 缺失字段补齐（默认值/模型估计）。
  * 时间纠偏（允许设备时钟漂移阈值）。
  * 黑白名单与字典表（站点、门架、车型）。

### 5.2 实时计算与告警

* **实时套牌车检测（必做扩展场景）**

  * 逻辑：同一车牌在短时间（例如10分钟）内出现在空间上不可能到达的两个卡口/门架。
  * Flink：基于事件时间、乱序水位线、滑动窗口/会话窗口。
  * 输出：告警事件（含证据链：两条事件、距离、最小可达时间、置信度）。

* **车流预警与拥堵预测（必做扩展场景）**

  * 实时车流预警：对收费站/路段的车流做短窗口统计（1min/5min）并对比阈值或历史基线。
  * 预测模型：

    * Spark ML 或轻量回归/分类（线性回归、GBDT、XGBoost可选）训练历史数据。
    * 输出未来15/30/60分钟车流预测与风险等级。
  * 预警分级：绿/黄/橙/红（阈值、增长率、模型置信）。

* **可选：逃费/异常交易稽核**

  * 同一车辆频繁短距离出入站、费用异常、车型不一致等规则。

### 5.3 查询与交互式访问

* 多条件组合查询：

  * 按车牌：最近N次过车、轨迹回放（时间轴）
  * 按站点/门架：指定时间段车流、平均速度、车型分布
  * 按告警：类型/等级/时间/区域筛选、查看证据与处置状态
  * 关键字检索：站点名称、路段名称

* 交互要求：

  * 页面筛选条件可联动（区域 -> 路段 -> 站点 -> 门架）。
  * 查询结果支持导出（CSV/Excel）与分享链接（带权限）。

### 5.4 可视化大屏（30秒刷新）

* 大屏布局建议（16:9）

  1. 左侧：全网车流趋势（实时折线，最近30分钟）
  2. 中央：地图态势（路段热力、站点状态灯、告警点位）
  3. 右上：告警滚动列表（套牌/拥堵/设备）
  4. 右中：TOP榜（车流最高站点、拥堵路段）
  5. 右下：预测卡片（未来30分钟高风险站点）
* 刷新机制：

  * 前端每30秒拉取一次聚合接口，或使用WebSocket订阅并在30秒节点做视图刷新。

### 5.5 车主端功能（增强题目创造力）

* 路线规划（MVP）：

  * 输入起终点，输出最短时间/最少费用/避开拥堵方案。
  * 结合实时拥堵与预测，对未来一小时的风险进行提示。
* 费用估算与账单：

  * 按车型、路线、时间段估算通行费；查询历史通行记录。
* 行程提醒：

  * 订阅常用路线，一旦预测拥堵或出现管制事件，推送提醒。
* 车辆异常提醒（隐私合规前提）：

  * 若平台检测到疑似套牌，向车主端提示“可能存在异常使用”，引导核验。

---

## 6. 非功能需求

### 6.1 性能

* 写入：至少50条/秒持续写入，设计上按 500条/秒预留冗余。
* 查询：

  * 点查（车牌最近记录）P95 < 300ms（HBase/缓存命中场景）
  * 聚合（站点5分钟统计）P95 < 2s（预聚合或OLAP表）
* 大屏：每30秒刷新，接口响应稳定。

### 6.2 可用性与扩展性

* 组件可横向扩展（Kafka分区、Flink并行度、HBase Region）。
* 关键服务支持无状态部署与滚动升级。

### 6.3 安全与审计

* 账号体系：交通管理人员与车主分域（RBAC）。
* 敏感数据脱敏：车牌显示可按权限部分遮罩。
* 审计：查询与导出操作记录。

### 6.4 可靠性与数据治理

* 数据落地至少两份：原始事件（热）+ 汇总指标（温/冷）。
* 数据保留策略：

  * 原始过车事件保留30-180天（按资源调整）
  * 汇总指标保留1-3年

---

## 7. 总体架构设计（推荐Kappa为主，分层存储）

### 7.1 架构分层

1. **采集/生成层**：数据模拟器 + 外部数据源 -> Kafka
2. **处理层**：Flink 实时清洗 + 窗口聚合 + 告警检测
3. **存储层**（冷热分层）

   * HBase：高吞吐、时序点查（原始事件、轨迹回放、证据链）
   * MySQL 分片（ShardingSphere 或 MyCat+MySQL）：结构化维表、告警工单、预聚合报表
4. **服务层**：查询服务、告警服务、预测服务、路线服务
5. **展示层**：大屏（管理端）、车主端（Web/H5/小程序）

### 7.2 数据流（关键链路）

* 事件写入：Generator -> Kafka -> Flink(ETL/去重/补全) -> HBase(明细)
* 指标写入：Flink窗口聚合 -> MySQL分片(指标表)
* 告警写入：Flink规则/模型 -> MySQL(告警) + Kafka(通知) -> WebSocket/执法终端
* 离线训练：HBase/MySQL抽取 -> Spark ML训练 -> 模型仓库 -> 在线预测服务

---

## 8. 存储与数据模型设计

### 8.1 HBase 设计（明细与点查）

#### 8.1.1 表设计

* `t_pass_event`：过车事件明细
* `t_plate_trace`：车牌轨迹索引（可选，提升按车牌查询）
* `t_alert_evidence`：告警证据链

#### 8.1.2 RowKey 设计原则

* 高基数、防热点、支持范围扫描。
* 常见查询：

  * Q1：按车牌查询最近N条
  * Q2：按站点/门架在时间范围内查询

#### 8.1.3 推荐RowKey方案（双索引）

1. **按车牌查询优化（轨迹回放）**

* RowKey：`salt(plate)%N + "#" + plate + "#" + reverse_ts`

  * `reverse_ts = Long.MAX_VALUE - event_time` 便于“最新在前”扫描
  * `salt` 打散热点

2. **按门架/站点查询优化（区域态势）**

* RowKey：`salt(gantry)%N + "#" + gantry_id + "#" + ts`

  * 支持按 gantry_id + 时间范围 scan

> 存储策略：同一事件可写入两张表（写放大换查询性能），或写入一张明细表并异步构建索引表。

#### 8.1.4 Key-Value 查询示例

* 给定 `plate_no` 与时间范围：scan `t_plate_trace` 前缀 `salt#plate#` 并限制stopRow。
* 给定 `gantry_id` 与时间窗口：scan `t_pass_event_by_gantry` 前缀 `salt#gantry#`。

### 8.2 MySQL 分片设计（业务态、聚合与报表）

#### 8.2.1 为什么要分片

* 指标表按时间持续增长，查询多为“按站点/时间段”聚合。
* 告警表与工单表存在高并发写入与状态更新。

#### 8.2.2 分片策略（ShardingSphere示例）

* 库分片：按区域/省份 `region_code`（减少跨区join）
* 表分片：按日期 `yyyyMM`（按月分表）
* 典型表：

  * `agg_station_flow_yyyyMM`（站点分钟级车流聚合）
  * `agg_section_speed_yyyyMM`（路段平均速度）
  * `alert_event_yyyyMM`（告警事件与处置状态）

#### 8.2.3 全局统计

* 采用“全局汇总表”或“异步聚合任务”

  * Flink写入分片明细/分区指标
  * 同步/异步维护 `agg_global_flow_yyyyMM`（全网总量）
* 对需要跨分片统计的查询，提供“聚合查询服务”进行并行查询与合并。

---

## 9. 实时计算设计示例

### 9.1 Flink 作业拆分

* Job1：`ETL_Cleaning`（去重、补全、标准化、写HBase）
* Job2：`Window_Aggregation`（按站点/路段滚动聚合，写MySQL分片）
* Job3：`Plate_Clone_Detection`（套牌检测，写告警与证据）

### 9.2 套牌检测算法（工程可实现版本）

* 输入：`plate_no, event_time, gantry_id, (lat,lon)`
* 预处理：站点/门架维表补齐地理坐标。
* 规则：在窗口 W 内（如10分钟），若同车牌出现两点距离 `d`，而最短可达时间 `t_min = d / v_max`，若 `Δt < t_min * α`（α为容忍系数，如0.8），则告警。
* 输出：

  * `confidence = sigmoid((t_min - Δt)/t_min)` 或分级置信。

### 9.3 车流预警与预测

* 实时预警（规则）：

  * 指标：`flow_1min`, `flow_5min`, `growth_rate`。
  * 阈值：静态阈值 + 历史同周同刻基线（可选）。
* 预测（模型）：

  * 特征：时间特征（小时/星期/节假日）、近N窗口车流、天气/事件（可选）、站点属性。
  * 输出：未来15/30/60分钟车流 + 风险等级。

---

## 10. 服务与接口

### 10.1 服务划分

* `ingestion-service`：数据模拟与接入配置
* `query-service`：统一查询API（HBase + MySQL）
* `alert-service`：告警管理、处置流转、通知
* `prediction-service`：模型加载、在线推断
* `route-service`：路线规划与费用估算（MVP）
* `dashboard-service`：大屏聚合接口、WebSocket推送
* `auth-service`：用户/权限

### 10.2 API 示例（摘要）

* `GET /api/dashboard/overview?window=30m`：大屏概览（30秒刷新调用）
* `GET /api/query/plate/{plateNo}?limit=50`：车牌最近轨迹
* `GET /api/query/gantry/{gantryId}?start=&end=`：门架时间段过车
* `GET /api/alerts?type=CLONE&level=HIGH&start=&end=`：告警列表
* `POST /api/alerts/{id}/actions`：处置动作（确认/驳回/转派）
* `GET /api/predict/station/{stationId}?horizon=30m`：预测车流
* `POST /api/route/plan`：路线规划（起终点、偏好）

---

## 11. 可视化与交互原型（页面级规划）

### 11.1 管理端页面

1. 登录与权限
2. 大屏（实时态势）
3. 车流分析（历史趋势、对比、钻取）
4. 告警中心（套牌、拥堵、设备）
5. 车辆画像/轨迹回放
6. 维表与配置（站点、门架、阈值、规则参数）
7. 报表导出（日报/周报/月报）

### 11.2 车主端页面

1. 路线规划
2. 实时路况与预测
3. 通行记录与费用
4. 订阅与提醒
5. 异常提示与申诉入口（可选）

---

## 12. 数据生成与“AI扩充”实施方案

### 12.1 目标

* 以课程样例为种子，生成更丰富、更真实分布的数据，满足持续 50条/秒。
* 同时生成“正常轨迹”与“异常轨迹（套牌/不合理跳点）”以验证告警效果。

### 12.2 方法组合

* **统计分布采样**：从样例估计站点热度、时间分布、车型占比。
* **规则引擎生成**：路径连贯性、速度上限、相邻门架转移矩阵。
* **AI补全/扰动**：对缺失字段、车辆属性、交易细节做合理生成。

### 12.3 LLM提示词（用于生成扩充样本的思路）

* 输入：站点/门架列表、车型字典、时间段、约束（速度/距离/车牌规则）。
* 输出：符合约束的JSON事件序列。

---

## 13. 部署与运维设计

### 13.1 环境建议（演示版）

* Kafka（3节点或单机多broker）
* Flink（Standalone 或 Yarn/K8s）
* HBase（伪分布或最小集群）
* MySQL（多实例模拟分片）+ ShardingSphere Proxy（或MyCat）
* Redis（可选缓存）
* Prometheus + Grafana（可选监控）

### 13.2 可观测性

* 指标：Kafka积压、Flink延迟、HBase写入/读延迟、MySQL QPS、接口P95。
* 日志：链路trace_id贯穿 ingestion -> processing -> storage -> api。

---

## 14. 测试与验收标准

### 14.1 功能验收

* 数据可持续生成并接入（50条/秒），预处理生效（去重、补全）。
* HBase可按车牌/门架实现key-value/scan查询。
* MySQL分片可支撑站点/路段聚合统计，能进行全局统计展示。
* 大屏可每30秒刷新，数据变化可见。
* 套牌检测：能产生告警并展示证据链。
* 车流预警/预测：能输出预警等级与预测曲线。

### 14.2 性能验收（建议阈值）

* 端到端延迟：事件进入Kafka到大屏可见 < 10秒（演示版）
* 点查：车牌最近50条 < 1秒
* 聚合：站点5分钟统计 < 2秒

---

## 15. 里程碑计划

1. 第1阶段：数据字典与接入（Kafka + 生成器）
2. 第2阶段：Flink清洗与HBase落地
3. 第3阶段：聚合指标写入MySQL分片 + 大屏刷新
4. 第4阶段：套牌检测告警链路
5. 第5阶段：预测模型训练与在线推断
6. 第6阶段：车主端路线规划MVP与整体联调

---

## 16. 风险与应对

* **热点RowKey导致Region热点**：加盐、双索引、预分区。
* **跨分片统计复杂**：预聚合、异步全局汇总表。
* **实时与离线指标不一致**：统一口径、口径版本管理、数据校验任务。
* **隐私合规**：脱敏展示、权限控制、审计追踪。

---

## 17. 交付物清单（建议提交）

* 需求分析与设计文档（本稿）
* 系统架构图、数据流图
* 存储设计（HBase RowKey、MySQL分片规则）
* 接口文档（OpenAPI/Swagger）
* 大屏原型图（页面布局与组件说明）
* 演示数据生成器与运行脚本
* 演示视频或截图（大屏刷新、告警生成、查询演示）

---

## 18. 视觉体验升级规划（对标样例并显著提升）

> 题目样例已经包含：门户落地页、交通监控大屏、交互式查询表格、离线预测与建议页。为实现“更好的视觉效果 + 更多样功能”，本项目在**设计系统、信息架构、动效、数据表达、交互深度**五个维度升级，并给出可直接落地的页面规格与组件清单。

### 18.1 设计目标与原则

* **一眼可读**：关键指标在3秒内可理解；层级明确，避免装饰性边框堆叠。
* **可钻取**：从“全网态势”到“省/路段/站点/车道”支持两级以上下钻与回溯。
* **可解释**：预测与告警提供证据链和解释因子，避免“黑盒数值”。
* **一致性**：统一的颜色体系、字号体系、间距体系、图表规范。
* **工程友好**：组件化实现（可复用图表卡片/筛选器/地图图层/告警列表）。

### 18.2 视觉风格方案（推荐两套主题）

**主题A：指挥大屏（Dark Tech）**

* 背景：深色渐变 + 轻粒子/星尘噪点（低对比度）
* 卡片：半透明玻璃拟态（glassmorphism），细描边 + 轻外发光
* 强调色：青蓝为主，橙/红用于告警，绿色用于健康态
* 适配：1920×1080 / 2560×1440

**主题B：管理后台/车主端（Light Modern）**

* 背景：浅灰或纯白，卡片阴影轻、边界干净
* 组件：更重视表单与表格可用性（密度可切换）
* 适配：响应式（>=1280宽为主），支持移动端H5（车主）

> 两套主题共享同一套 Design Tokens（颜色/字号/圆角/间距/阴影），只切换 token。

### 18.3 Design Tokens（核心规范，便于前端实现）
* **阴影**：轻阴影（后台）；外发光（大屏）
* **颜色语义**（必须语义化，不直接写死）：

  * `primary`（青蓝）
  * `success`（绿）
  * `warning`（橙）
  * `danger`（红）
  * `info`（蓝紫）
  * `text_primary / text_secondary / border / bg`
* **图表规范**：同类指标全站统一配色与单位；所有图表必须展示“时间窗/口径/刷新时间”。

### 18.4 动效与细节（提升“高级感”的关键）

* 大屏：

  * KPI 数字滚动（带缓动）
  * 告警 ticker 跑马灯（可暂停、可展开）
  * 地图流向线动画（车流方向），热点脉冲点
  * 面板切换采用“淡入 + 轻位移”，不使用夸张翻页
* 后台：

  * 表格加载 skeleton
  * 查询条件展开/收起
  * 图表 hover 提示含“同比/环比/阈值线”

---

## 19. 页面与信息架构升级（超越样例的功能清单）

### 19.1 门户/落地页（对标样例首页并升级）

**现有样例**：视频背景 + 标题 + 简单导航。

**升级目标**：把落地页做成“系统入口 + 即时态势摘要”。

* 顶部导航：数据大屏｜运行监控｜离线分析｜交互式查询｜告警中心｜系统配置
* 首屏 Hero：背景视频/图片 + 半透明遮罩（保证文字可读）
* 关键能力卡片（首屏即可见）：

  * 今日车流（全网）/ 今日告警 / 数据接入延迟 / 在线设备数
* 快速入口：

  * 一键进入大屏（全屏）
  * 选择省份/路网视角
  * 演示数据开关（开发/展示必备）
* 页尾：数据口径说明、版本信息、系统状态（绿色正常/黄色降级）

### 19.2 交通监控大屏（核心升级点）

**大屏目标**：从“静态看板”升级为“可指挥、可回放、可钻取”的作战界面。

#### 19.2.1 大屏布局建议（更清晰、更少边框、更强层级）

* 顶部：全局标题 + 时间 + 数据延迟 + 当前视角（全国/省/路段）
* 左侧：KPI 区（车流、平均速度、拥堵指数、告警数、逃费疑似）
* 中央：主地图（支持图层与下钻）
* 右侧：告警中心 + 热点TOP（可切换 tab）
* 底部：趋势与预测（最近30分钟趋势 + 未来30分钟预测）

#### 19.2.2 地图能力（让大屏“比样例更强”）

* 多级下钻：全国 -> 省 -> 城市/路网 -> 站点/门架
* 多图层：

  * 车流热力（按路段/站点）
  * 拥堵热力（速度/密度估算）
  * 告警点位（套牌/拥堵/设备）
  * 事件图层（事故/施工/天气，演示可模拟）
* 时间回放：选择时间段，回放车流与告警演化（演示效果极佳）

#### 19.2.3 大屏交互与联动

* 点击地图站点 -> 右侧弹出站点详情（车道开通、5分钟流量、预测、告警）
* 点击告警 -> 地图自动定位，并展示证据链（两点事件、距离、最小可达时间）
* TOP榜点击 -> 触发筛选联动（地图高亮 + 下方趋势切换）
* 自动轮播：每60秒轮播不同省份/重点站点（展示友好）

#### 19.2.4 额外“更像真实项目”的模块

* **系统运行态**：Kafka积压、Flink延迟、HBase写入QPS、接口P95（小卡片显示）
* **大屏降级策略**：当接口超时，自动使用缓存/上次数据并提示“数据延迟xx秒”

### 19.3 交互式查询（对标样例表格页并升级为“分析工作台”）

**现有样例**：条件筛选 + 表格。

**升级为**：查询 + 统计 + 可视化 + 导出任务 的一体化工作台。

#### 19.3.1 查询能力增强

* 条件分层：基础条件（车牌/站点/时间） + 高级条件（车型/轴数/异常类型/速度范围）
* 查询构建器（Query Builder）：可视化拼条件并生成 SQL/DSL（便于演示“工程规范”）
* 保存查询：保存为模板，可共享给同角色用户
* 结果二次分析：

  * 一键生成统计图（按车型占比、按小时车流）
  * 切换“明细视图/聚合视图”

#### 19.3.2 表格可用性升级

* 列配置：显示/隐藏、拖拽排序、固定列
* 行展开：展示证据链/轨迹小地图/关联交易
* 批量操作：导出、加入关注、发起稽核工单
* 异步导出：大数据导出走后台任务，页面显示进度与下载链接

### 19.4 离线预测与治理建议（对标样例预测页并升级为“决策驾驶舱”）

**现有样例**：天气 + 表格 + 简单建议 + 前/后流量曲线。

**升级为**：预测结果（带置信区间）+ 场景模拟 + 可执行建议（工单/预案）。

* 预测维度：车流、拥堵等级、平均速度、排队长度（可模拟）
* 预测跨度：15/30/60分钟 + 次日高峰（离线批任务）
* 置信区间：展示 P50/P90（让结果更可信）
* 场景模拟（亮点）：

  * “加开x个ETC车道”对排队的影响
  * “限流/分流”对拥堵的影响
* 治理建议输出：

  * 建议列表（按收益排序）
  * 一键生成预案（派单给值班人员，或生成报告）

### 19.5 告警中心（样例未突出，本项目补齐）

* 告警类型：套牌疑似、拥堵预警、设备异常、异常交易（可选）
* 告警流转：新建 -> 研判中 -> 已确认 -> 已处置/已驳回
* 证据链：

  * 套牌：两点事件、距离、时间差、最小可达时间、置信度
  * 拥堵：阈值、增长率、历史基线对比
* 通知：站内通知 + WebSocket 推送（可扩展短信/邮件）

### 19.6 车主端（让项目“比课程样例更完整”）

* 路线规划：最短时间/最少费用/避开拥堵
* 未来一小时拥堵风险提示（基于预测结果）
* 通行账单：按月统计、异常扣费提示（模拟）
* 行程订阅：常用路线拥堵/事故推送

---

## 20. 可视化组件清单（用于高保真原型与前端实现对齐）

### 20.1 大屏组件（必须组件化）

* `KPIStatCard`：指标卡（主值/单位/环比/状态点）
* `TrendMiniChart`：30分钟趋势小图
* `AlertTicker`：告警滚动条
* `AlertList`：告警列表（支持筛选/展开证据）
* `MapContainer`：地图容器（图层开关、下钻、时间回放）
* `TopRankList`：TOP榜（站点/路段/车型）
* `HealthStatusCard`：系统健康卡（延迟、积压、P95）

### 20.2 工作台组件

* `AdvancedFilterBar`：高级筛选器（可折叠）
* `QueryBuilder`：条件构建器（生成SQL/DSL）
* `ResultTable`：结果表格（列配置、行展开、批量操作）
* `ExportTaskPanel`：导出任务面板（进度/失败重试）
* `InsightPanel`：洞察面板（自动生成统计图与摘要）

### 20.3 预测与建议组件

* `ForecastChart`：预测曲线（置信区间）
* `ScenarioSimulator`：场景模拟（滑杆/输入框）
* `RecommendationCard`：建议卡（原因、收益、操作按钮）

---

## 21. “比样例更多样”的业务功能扩展（建议挑选实现）

### 21.1 轨迹回放与时空分析（强演示亮点）

* 输入车牌 + 时间段，输出轨迹（地图+时间轴）
* 轨迹异常点标注（跳点/超速/逆行可选）
* 关联查询：点击轨迹点 -> 展示该卡口过车详情

### 21.2 事件融合（事故/施工/天气）

* 引入模拟事件源：事故、施工、恶劣天气
* 关联影响评估：事件发生后车流/速度变化，形成“影响半径”可视化

### 21.3 稽核与工单（管理闭环）

* 告警一键生成工单，分派到人员或班组
* 工单SLA：超时提醒、处置记录
* 报表：班组处置效率、误报率、确认率

### 21.4 数据治理与口径管理（更像真实平台）

* 指标口径版本：同一指标在不同版本的计算方式可追溯
* 数据质量看板：缺失率、重复率、延迟分布

---

## 22. 前端工程化与性能体验（实现更好视觉效果的保障）

### 22.1 大屏性能要点

* 图表刷新：30秒刷新仅更新数据，不重建组件树
* 地图图层：分层渲染，热点点位采用聚合/抽稀
* 数据量控制：大屏只展示聚合，明细下钻后再查

### 22.2 体验要点

* 全局加载策略：骨架屏 + 局部加载
* 失败重试：接口失败回退缓存，并提示“数据延迟/降级”
* 统一格式化：时间、单位（辆/分钟、km/h）与千分位

### 22.3 推荐实现技术（不强绑定，可按掌握程度取舍）

* 大屏图表：ECharts / AntV（含地图与3D扩展）
* 管理后台：任意主流框架 + 组件库（Element/Ant Design/NaiveUI均可）
* 动效：CSS 动画 + Lottie（轻量）

---

## 23. 高保真原型与视觉交付物（建议作为最终成果的一部分）

* 设计系统（Design Tokens + 组件库截图/说明）
* 4张关键页面高保真：

  1. 门户首页
  2. 交通监控大屏（含下钻态）
  3. 交互式查询工作台（含行展开/导出任务）
  4. 预测与建议驾驶舱（含场景模拟）
* 大屏布局标注：分辨率、栅格、组件尺寸、刷新策略
* 图表口径说明：每个图表的口径、时间窗、数据源表

---

## 24. 本项目“技术特色总结”升级版

1. Kafka + Flink 实时清洗、聚合、告警（端到端可观测）
2. HBase 双索引 RowKey 设计，支持车牌点查与门架时间范围扫描
3. MySQL 分片（ShardingSphere/MyCat）承载指标与业务态，实现可扩展聚合查询
4. 大屏 30 秒刷新 + WebSocket 通知，支持地图下钻与时间回放
5. 套牌检测证据链与处置闭环（告警中心 + 工单）
6. 离线预测（LSTM/回归可选）+ 在线推断 + 场景模拟建议
7. Redis 缓存与降级策略保障展示稳定
8. Docker Compose 一键部署演示环境（便于验收与复现）

---

## 25. 前端实现说明

本项目前端部分基于开源项目 art-design-pro 进行二次开发，优点如下：

1. **快速启动**：利用成熟框架快速搭建项目骨架
2. **组件丰富**：集成了大量可复用组件
3. **代码规范**：遵循Vue 3最佳实践
4. **易于扩展**：模块化设计便于后续功能添加

**当前实现状态**：
- ✅ ETC实时监控指挥舱（完整大屏展示，含徐州交通地图、区域排名、告警列表等）
- ⏳ 数据查询中心（框架搭建完成，待开发具体功能）
- ⏳ 离线预测分析（框架搭建完成，待开发具体功能）

**菜单优化**：
为聚焦ETC业务，已通过路由配置（`meta.isHide = true`）隐藏开源项目中的其他模块菜单，仅保留ETC大数据平台相关菜单。所有功能代码均未删除，随时可通过调整路由配置恢复显示。

**技术栈**：
- 框架：Vue 3 + Vite + TypeScript
- UI组件：Element Plus + Naive UI（混合使用）
- 状态管理：Pinia
- 路由：Vue Router 4
- 样式：SCSS + UnoCSS

**访问地址**：
- 系统首页：http://localhost:5174/
- ETC实时监控：http://localhost:5174/etc/monitor
- 数据查询中心：http://localhost:5174/etc/query
- 离线预测分析：http://localhost:5174/etc/prediction
