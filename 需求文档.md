# 高速公路ETC大数据管理平台需求分析文档

## 一、项目背景与目标

近年来，取消高速省界收费站和“视频云联网”等政策驱动下，ETC（电子不停车收费）感知设备大规模部署，大量车流和传感器产生的时序数据呈指数级增长伴随着物联网技术的发展和车流量的增长，带来了来自摄像头、传感器、门架系统等多方所产生的数据呈指数级增长，特别是交通运输部近年来主导实施了如“取消高速公路省界收费 站”和“高速公路视频云联网”等重大项目，极大地提升了高速公路上 ETC 门架、智能摄像机等感知设备的建设规模。而这些传感器设备所产生的海量数据都带有时序特征，利用好这些数据可以为智慧高速运营管理提供更可靠的数据分析服务。)。这些数据具备高并发写入、实时分析的需求，可为高速公路的路况监测、拥堵预警、流量调度等提供可靠支持。项目目标包括：构建一个**实时采集、高效处理、高度可视化**的ETC大数据管理平台，实现对路网车流的综合监测与管理，为交通管理人员提供决策支持，同时为普通车主提供个性化的出行服务。



## 二、用户角色

- **交通管理人员**：负责路网运行监控、交通流量分析、违章识别和事件响应。需求包括历史数据查询、流量统计、拥堵预警和热力图展示等，帮助制定管控措施和优化调度方案。
- **普通车主**：关注行驶路线规划、实时路况、车辆信息和缴费提示等。希望通过平台获取个性化出行建议（如避堵路线、限行通知）、查看车辆历史通行记录和ETC缴费提醒等服务。

## 三、核心功能模块

- **数据采集与预处理：** 系统需支持每秒约50条以上的ETC通行数据写入，并实时进行数据清洗、纠错和格式转换。典型架构采用**Kafka**等消息队列做中间层，进行数据缓冲和流式分发[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=物联网也可以分为传统的收费专网、监控专网和互联网。第三层来到数据层，在数据层传统关系型数据库和时序数据库依据各自优势，协同发挥作用。所有数据经过 Kafka 消息队列处理之后进入 Redis 缓存池，最终存储到数据库中。所有设备产生的时序数据都由,接口交互。第四层是应用支撑层。基础支撑平台是支撑平台应用的引擎底座，通过对存储的数据进行分析处理，为上层应用提供支撑，主要包括数据接口认证、BI 分析工具、GIS 地图、Zookeeper 监测工具、智慧高速算法引擎和视频智能分析算法等基础支撑服务。最上层就是应用层。在对数据进行处理分析之后，为平台用户提 供实时路况分析、拥堵治理、交通流量监测和匝道智能控流等多个应用场景。)。如InfoQ案例所示，设备产生的时序数据可通过Kafka消费，并进行噪声去除后更新至关系型和时序数据库[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=物联网也可以分为传统的收费专网、监控专网和互联网。第三层来到数据层，在数据层传统关系型数据库和时序数据库依据各自优势，协同发挥作用。所有数据经过 Kafka 消息队列处理之后进入 Redis 缓存池，最终存储到数据库中。所有设备产生的时序数据都由,接口交互。第四层是应用支撑层。基础支撑平台是支撑平台应用的引擎底座，通过对存储的数据进行分析处理，为上层应用提供支撑，主要包括数据接口认证、BI 分析工具、GIS 地图、Zookeeper 监测工具、智慧高速算法引擎和视频智能分析算法等基础支撑服务。最上层就是应用层。在对数据进行处理分析之后，为平台用户提 供实时路况分析、拥堵治理、交通流量监测和匝道智能控流等多个应用场景。)[fanruan.com](https://www.fanruan.com/blog/article/334560/#:~:text=在建立实时数据仓库时，首要任务是从各种数据源接入数据。Flink提供了丰富的连接器，支持多种数据源如Kafka、RabbitMQ、文件系统、数据库等。通过这些连 接器，可以将数据源的数据实时地引入到Flink的流处理系统中。)。Flink流式计算框架可用于对Kafka数据进行窗口聚合、关联检测等处理，保证低延迟和高吞吐（通过Flink的丰富连接器可无缝对接Kafka、MySQL等数据源[fanruan.com](https://www.fanruan.com/blog/article/334560/#:~:text=在建立实时数据仓库时，首要任务是从各种数据源接入数据。Flink提供了丰富的连接器，支持多种数据源如Kafka、RabbitMQ、文件系统、数据库等。通过这些连 接器，可以将数据源的数据实时地引入到Flink的流处理系统中。)）。预处理过程中还应进行车牌识别比对、异常数据过滤等操作，为后续分析提供可靠数据。
- **数据存储与管理：** 存储方案可选用**HBase**或**MyCat+MySQL（ShardingSphere）**等分布式架构。高速公路ETC数据量大、写入吞吐高，根据研究单个ETC门架每日峰值数据可达万条级别[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=根据行业调研我们发现，仅以高速公路的 ETC 门架来说，其单日单一设备的时序数据采集量峰值可以达到上万条；与此同时，从高速公路整体的数据容量而言，单个省份每年高速公路的时序数据存储容量需求会达到 PB 级别。在这种数据规模下，以,Tree 结构在处理时序数据的检索查询问题时，速度较慢，致使数据的实时分析和展示效果都很差。而这正是 TSDB)，支持高并发写入是关键。HBase作为列式分布式存储，擅长大规模写入，可提供高吞吐和线性扩展[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=可以从这个图中看出，一般在实时领域会选择 HBase，Cassandra 这种能支持事务同时支持高更新吞吐量的技术组件，或者也可以选择 TiDB、Spanner、Kudu 等这种,HTAP 组件，同时支持事务和分析的分布式数据库。)；若选用MySQL方案，则需通过分库分表中间件（MyCat或ShardingSphere）设计分片规则，确保单表数据量控制在合理范围。行键（RowKey）设计应避免简单的时间戳顺序，以防写入热点[help.aliyun.com](https://help.aliyun.com/zh/hbase/user-guide/rowkey-design#:~:text=单调递增行键%2F时序数据)，可采用反转时间戳或加盐/hash等方式分散负载[help.aliyun.com](https://help.aliyun.com/zh/hbase/user-guide/rowkey-design#:~:text=单调递增行键%2F时序数据)。此外，要规划全局统计或聚合查询策略，例如预计算汇总表或使用OLAP组件预聚合关键指标，以支持全网级别的实时统计查询。
- **数据查询与分析：** 平台需支持多条件、交互式查询，满足管理人员检索车辆通行记录、流量统计和账单报表等需求。对于灵活多维度查询，可借助搜索引擎（如Elasticsearch）或OLAP引擎建立索引，实现快速筛选与聚合[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=而 Elastic Search 是相对最为灵活的一个 NoSQL,查询引擎，一方面它支持全文索引，这个是其他引擎所不具备的。另外它也支持少量的更新，支持聚合分析，也支持明细数据的搜索查询，在近实时领域适用场景非常的多。不过由于 ES 是基于 Lucene 的存储引擎，相对需要资源成本会更高，而且分析性能对比其他引擎不具备优势。)[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=计算维度和计算灵活度，这两个因素是对计算选型很重要的因素。试想一下，如果我们的产品只产出固定的若干指标项，我们完全可以使用 Spark 离线计算将数据结果导入到 MySQL 等业务数据库中，作为结果集提供展示服务。)。例如，通过ElasticSearch构建全文和过滤查询能力，可以对车牌号、通行时间、收费站等字段进行任意组合查询[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=而 Elastic Search 是相对最为灵活的一个 NoSQL,查询引擎，一方面它支持全文索引，这个是其他引擎所不具备的。另外它也支持少量的更新，支持聚合分析，也支持明细数据的搜索查询，在近实时领域适用场景非常的多。不过由于 ES 是基于 Lucene 的存储引擎，相对需要资源成本会更高，而且分析性能对比其他引擎不具备优势。)；对需要定制报表的场景，可使用Apache Kylin等Cube工具预计算指标，大幅缩短查询延迟并保持交互体验[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=计算维度和计算灵活度，这两个因素是对计算选型很重要的因素。试想一下，如果我们的产品只产出固定的若干指标项，我们完全可以使用 Spark 离线计算将数据结果导入到 MySQL 等业务数据库中，作为结果集提供展示服务。)。
- **实时可视化大屏：** 为交通管理决策提供大屏展示，呈现全网路况概览。界面可包括高速公路地图、各路段流量/速度实时图表、站点进出口流量统计等模块，每30秒自动刷新一次数据。可视化可使用ECharts、Grafana等图表库，将关键指标（如车流量、拥堵指数、异常事件数）以图形、热力图等形式动态展现，支持管理人员快速了解交通态势。

## 四、功能扩展与智能应用

- **实时套牌车检测：** 利用Kafka+Flink流处理实现车牌重复检测。当车辆通过不同门架时，对比最近一定时间窗口内出现的车牌号，若发现重复出现则判定为可疑套牌，实现实时报警推送至执法终端。Flink的窗口算子可对流数据进行实时聚合和匹配，提高检测速度和准确性[fanruan.com](https://www.fanruan.com/blog/article/334560/#:~:text=符串数据转换成数值类型。)。
- **收费站车流量预警：** 对历史车流数据进行模型训练，预测未来路段拥堵风险。可采用Spark MLlib对汇总的通行量、速度等数据进行回归或机器学习算法（如随机森林、神经网络等）训练，构建短期流量预测模型。模型可定期离线更新，实时系统根据预测结果输出各站点或路段的拥堵预警，帮助交通管理部门提前采取疏导措施。
- **路线规划服务：** 针对普通车主提供动态导航功能，类似地图导航服务。系统应调用第三方地图服务（如腾讯地图、高德地图）的驾车路径规划API，结合实时路况和偏好条件（少收费、不走高速等）计算最优路线[lbs.qq.com](https://lbs.qq.com/webservice_v1/guide-road.html#:~:text=腾讯地图Direction API，提供多种交通方式的路线计算能力，包括： 1,公交（transit）：支持公共汽车、地铁等多种公共交通工具的换乘方案计算；)。例如，腾讯地图驾车API支持基于实时交通“时间最短”或“避免收费”策略规划路线[lbs.qq.com](https://lbs.qq.com/webservice_v1/guide-road.html#:~:text=腾讯地图Direction API，提供多种交通方式的路线计算能力，包括： 1,公交（transit）：支持公共汽车、地铁等多种公共交通工具的换乘方案计算；)。平台可以在此基础上叠加交通预警信息，动态调整推荐路线，为司机提供避堵和节约成本的路线建议。
- **综合管理控制台：** 为交通管理人员打造可视化操作界面，集成历史查询、违章（套牌等）检出、车流统计与热力图等功能。控制台应支持按时间、区域、车型等多维度查询历史通行数据，统计关键指标（如交易成功率、平均通行时间、分站流量分布等）；同时将实时预警（套牌、拥堵等）以地图热力图形式显示，突出热点区域。该界面可用Web技术实现，提供交互式图表、数据表格和地图组件，帮助管理人员综合分析交通态势。
- **用户终端个性化信息：** 提供移动端或Web端给车主展示个人相关信息，如历史通行记录、ETC账户余额与缴费提醒、出行建议等。系统可根据用户历史出行时段和偏好，推送个性化出行建议（比如节假日绕行方案）和优惠信息；同时发送缴费和年审等提醒通知，提升用户体验。

## 五、非功能性需求

- **性能要求：** 平台需支撑高并发写入和查询。针对每秒50条的ETC数据入库（每日约400万条），应预留充足的写入吞吐能力[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=根据行业调研我们发现，仅以高速公路的 ETC 门架来说，其单日单一设备的时序数据采集量峰值可以达到上万条；与此同时，从高速公路整体的数据容量而言，单个省份每年高速公路的时序数据存储容量需求会达到 PB 级别。在这种数据规模下，以,Tree 结构在处理时序数据的检索查询问题时，速度较慢，致使数据的实时分析和展示效果都很差。而这正是 TSDB)；同时确保可支持成百上千并发查询请求，关键查询（如图表刷新）延迟控制在秒级范围。数据预处理和统计任务应尽量采用流计算与批处理并行设计，以保证秒级或分钟级的分析反馈能力[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=通过研究，我们发现对高速公路时序数据的应用需求主要有：)。
- **可用性与扩展性：** 系统需具备高可用性设计，采用主备切换、自动重试等机制保证不丢数据。平台架构应可水平扩展，如通过增加Kafka分区、扩容HBase节点或MySQL分片节点来应对数据量增长和查询压力。技术选型上推荐使用容器化部署或云原生架构，以便快速扩展计算和存储资源。
- **数据安全与隐私：** ETC数据涉及车辆行驶轨迹和收费信息等敏感信息，需要严格保护[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=（1）数据高并发写入：高速公路 IoT 设备采集的时序数据每日入库数据量超亿级。)。应对数据库和传输通道进行加密，设置完善的用户权限控制和审计日志。系统对外提供接口时，要进行接口鉴权、访问控制，避免恶意访问或数据泄露。
- **运维与监控：** 需提供完善的监控告警和日志体系，对关键组件（Kafka、HBase/MySQL等）进行指标监控和故障告警。设计自动化运维脚本（如数据备份、集群扩容），确保平台稳定运行。文档和运维手册需配套完善，方便团队维护和升级。

## 六、可视化界面建议

- **大屏监控界面：** 采用地图+指标板块布局，中心区域为路网地图，叠加实时车流热力或拥堵线路；侧边或底部显示各类统计指标（总车流、拥堵站点TopN、今日异常事件等），并实时刷新。界面使用醒目的色彩区分安全、拥堵和警告状态，例如以红黄绿显示不同车流密度等级。
- **管理控制台界面：** 使用仪表盘和表格相结合的方式展示数据。首页可显示总体运行状况概览（今日流量、成功率、预警数等），并提供时间查询组件。违章或异常列表可在控制台提供检索和详情查看，地图热点图展示预警空间分布。在设计上强调交互性能，例如筛选、钻取和联动分析（点击图表元素可查看明细）。
- **用户端界面：** 移动端或响应式网页应重点展示个性化信息。首页显示用户提醒（未缴费账单、年审到期等）和今日出行建议。路线规划页面结合地图导航视图，突出推荐路线和路况预测。个人中心包含历史通行记录列表，可按时间、收费站查询明细，简单直观地展示历史数据与消费情况。

**参考资料：** 平台设计综合了高速公路数据平台建设经验[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=根据行业调研我们发现，仅以高速公路的 ETC 门架来说，其单日单一设备的时序数据采集量峰值可以达到上万条；与此同时，从高速公路整体的数据容量而言，单个省份每年高速公路的时序数据存储容量需求会达到 PB 级别。在这种数据规模下，以,Tree 结构在处理时序数据的检索查询问题时，速度较慢，致使数据的实时分析和展示效果都很差。而这正是 TSDB)[xie.infoq.cn](https://xie.infoq.cn/article/0bb8e54272b97c542a7fad902#:~:text=物联网也可以分为传统的收费专网、监控专网和互联网。第三层来到数据层，在数据层传统关系型数据库和时序数据库依据各自优势，协同发挥作用。所有数据经过 Kafka 消息队列处理之后进入 Redis 缓存池，最终存储到数据库中。所有设备产生的时序数据都由,接口交互。第四层是应用支撑层。基础支撑平台是支撑平台应用的引擎底座，通过对存储的数据进行分析处理，为上层应用提供支撑，主要包括数据接口认证、BI 分析工具、GIS 地图、Zookeeper 监测工具、智慧高速算法引擎和视频智能分析算法等基础支撑服务。最上层就是应用层。在对数据进行处理分析之后，为平台用户提 供实时路况分析、拥堵治理、交通流量监测和匝道智能控流等多个应用场景。)以及大数据架构方案选型原则[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=可以从这个图中看出，一般在实时领域会选择 HBase，Cassandra 这种能支持事务同时支持高更新吞吐量的技术组件，或者也可以选择 TiDB、Spanner、Kudu 等这种,HTAP 组件，同时支持事务和分析的分布式数据库。)[infoq.cn](https://www.infoq.cn/article/lyx4bb0q0pow3lgcfrtd#:~:text=而 Elastic Search 是相对最为灵活的一个 NoSQL,查询引擎，一方面它支持全文索引，这个是其他引擎所不具备的。另外它也支持少量的更新，支持聚合分析，也支持明细数据的搜索查询，在近实时领域适用场景非常的多。不过由于 ES 是基于 Lucene 的存储引擎，相对需要资源成本会更高，而且分析性能对比其他引擎不具备优势。)[lbs.qq.com](https://lbs.qq.com/webservice_v1/guide-road.html#:~:text=腾讯地图Direction API，提供多种交通方式的路线计算能力，包括： 1,公交（transit）：支持公共汽车、地铁等多种公共交通工具的换乘方案计算；)等前沿实践。上述模块和需求为交通管理和车主用户提供了全面支撑。